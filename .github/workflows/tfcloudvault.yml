name: tfcvault

on:
  push:
    branches: [ master ] 


jobs:
    build:
         runs-on: ubuntu-latest
         steps:
          
            - name: Import Secrets
              uses: hashicorp/vault-action@v2
              with:
                url: https://vault-cluster-public-vault-9d3cc5f0.ec174759.z1.hashicorp.cloud:8200/ui/vault/secrets/cubbyhole/show/foo?namespace=admin%2Ffoo
                tlsSkipVerify: true
                #caCertificate: ${{ secrets.TFC_CA }}
                #method: approle/role/my-role
                #method: approle
                #authPayload: |
                 # {
                #roleId: ${{ secrets.VAULT_AUTOMATION_ROLE_ID }}
                #secretId: ${{ secrets.VAULT_AUTOMATION_SECRET_ID }}

                token: \${{ secrets.TFCVAULT }}
                namespace: admin/foo/
                secrets: |
                    /cubbyhole/foo accesskey | AWS_ACCESS_KEY_ID ;
                    /cubbyhole/foo secretkey | AWS_SECRET_ACCESS_KEY 
      
            - name: Unit Test
              run: |
                  mkdir -p ~/.aws
                  touch ~/.aws/credentials
                  echo "[default]
                  aws_access_key_id = ${{ env.AWS_ACCESS_KEY_ID }} 
                  aws_secret_access_key = ${{ env.AWS_SECRET_ACCESS_KEY }}
                  region = us-east-1"
                  aws --version 
